<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180"
        href="https://raw.githubusercontent.com/Evelyn225/emergent-toys/main/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32"
        href="https://raw.githubusercontent.com/Evelyn225/emergent-toys/main/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16"
        href="https://raw.githubusercontent.com/Evelyn225/emergent-toys/main/images/favicon-16x16.png">
    <link rel="manifest" href="https://raw.githubusercontent.com/Evelyn225/emergent-toys/main/site.webmanifest">
    <title>DOM Roulette</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            position: relative;
        }

        #regenerateButton {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        #regenerateButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        #regenerateButton:active {
            transform: translateY(0);
        }

        #regenerateButton:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        #loadingOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-size: 18px;
            color: #333;
        }

        #loadingText {
            white-space: pre-wrap;
            word-wrap: break-word;
            text-align: center;
            max-width: 80%;
        }

        .wave-char {
            display: inline-block;
            animation: wave 0.6s ease-in-out infinite;
        }

        @keyframes wave {
            0%, 100% {
                transform: translateY(0);
                opacity: 1;
            }
            50% {
                transform: translateY(-8px);
                opacity: 0.7;
            }
        }

        #loadingOverlay.hidden {
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #generatedContent {
            min-height: 100vh;
        }
    </style>
</head>

<body>
    <button id="regenerateButton">üîÑ Regenerate Site</button>

    <div id="loadingOverlay">
        <div class="spinner"></div>
        <div id="loadingText">Generating your website...</div>
    </div>

    <div id="generatedContent"></div>

    <script>
        // API endpoints - uses Vercel serverless functions
        const RANDOM_WORDS_ENDPOINT = '/api/random-words.js';
        const GENERATE_ENDPOINT = '/api/generate.js';

        // Create the prompt for the AI
        function createGenerationPrompt(theme, persona) {
            const specialInstructions = getPersonaSpecialInstructions(persona.name);

            return `Generate a complete, self-contained HTML page inspired by: "${theme}"

YOU ARE: ${persona.name}
YOUR STYLE: ${persona.style}
YOUR APPROACH: ${persona.desc}

${specialInstructions ? specialInstructions + '\n\n' : ''}INSTRUCTIONS - DO NOT EXPLAIN, ONLY OUTPUT CODE:
- Output ONLY valid HTML/CSS/JavaScript code
- Do NOT include any explanations, descriptions, or markdown
- Do NOT include <html>, <head>, or <body> tags
- Include all CSS in <style> tags and all JS in <script> tags
- The code must be complete, robust, and runnable as-is
- EMBODY THE PERSONA - let ${persona.name}'s perspective guide your creative choices
- IT MUST TAKE A HUMAN AT LEAST 3 MINUTES TO FULLY EXPLORE AND APPRECIATE

DEPTH & COMPLEXITY REQUIREMENTS:
- Create a FULL, FLESHED-OUT experience, not a simple demo
- At least 10 unique DOM elements
- Add images, titles, and paragraphs of content where appropriate
- add multiple types of media (images, audio, video)
- Implement multiple interactive layers and systems
- Include state management and persistent behavior
- Add visual polish with smooth animations and transitions
- Create depth through layering, parallax, or 3D effects
- Implement game-like mechanics if appropriate (scoring, progression, challenges)
- Add narrative or contextual elements that develop over time
- Include multiple interactive zones or sections (not just one area)
- Create emergent complexity where interactions combine in unexpected ways

USE AT LEAST 1 OF THE FOLLOWING LIBRARIES::
- p5.js (https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js) - For generative art and sketches
- Three.js (https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js) - For 3D graphics and WebGL
- Chart.js (https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js) - For data visualizations
- rough.js (https://cdnjs.cloudflare.com/ajax/libs/rough.js/4.6.1/rough.min.js) - For hand-drawn sketchy effects
- Particles.js (https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js) - For particle systems
- anime.js (https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js) - For advanced animations
- gsap (https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js) - For timeline-based animations
- Tone.js (https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.9/Tone.js) - For audio synthesis and sequencing
- Howler.js (https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.4/howler.min.js) - For spatial audio and sound management
- wavesurfer.js (https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js) - For waveform visualizations
- Matter.js (https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js) - For 2D physics engine
- verlet-js (https://cdn.jsdelivr.net/npm/verlet-js@1.0.0/build/verlet.min.js) - For soft-body physics
- simplex-noise (https://cdn.jsdelivr.net/npm/simplex-noise@3.0.0/simplex-noise.min.js) - For Perlin/simplex noise
- Tippy.js (https://unpkg.com/@tippyjs@6.3.7/dist/tippy-bundle.umd.min.js) - For tooltips and popovers
- SortableJS (https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js) - For drag and drop
- Driver.js (https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.min.js) - For interactive tutorials

USE IMAGES FROM THESE APIs (choose based on theme):
- For abstract/artistic: https://picsum.photos/seed/${encodeURIComponent(theme)}/800/600
- For nature/landscapes: https://source.unsplash.com/800x600/?${encodeURIComponent(theme.replace(' ', ','))}
- For patterns/textures: https://picsum.photos/800/600?random=${Math.random()}
- For pixel art: https://api.dicebear.com/7.x/pixel-art/svg?seed=${encodeURIComponent(theme)}
- For icons: https://api.dicebear.com/7.x/icons/svg?seed=${encodeURIComponent(theme)}
- For avatars: https://api.dicebear.com/7.x/avataaars/svg?seed=${encodeURIComponent(theme)}
- For abstract gradients: https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent(theme)}
- For art photography: https://source.unsplash.com/800x600/?${encodeURIComponent(theme.replace(' ', ','))},art
- For city/architecture: https://source.unsplash.com/800x600/?${encodeURIComponent(theme.replace(' ', ','))},city
- For textures: https://picsum.photos/seed/${encodeURIComponent(theme)}-texture/900/700
- For backgrounds: https://www.freewebheaders.com/wordpress/wp-content/gallery/[CATEGORY]/[CATEGORY]-animated-gif-[RANDOM_1_TO_10].gif

VISUAL & DESIGN RICHNESS:
- Use gradients, shadows, filters, and effects extensively
- Implement animated backgrounds or dynamic lighting
- Create visual feedback for all interactions
- Use typography creatively - animate text, distort it, overlay it
- Build complex color palettes with intentional clashing
- Include decorative elements that serve no purpose but add richness
- Implement canvas/WebGL for advanced graphics
- Create visual hierarchies even in chaos

INTERACTIVITY DEPTH:
- Multiple interactive systems that work together
- Hover effects that are complex and layered
- Click handlers that trigger chains of events
- Keyboard input with multiple commands
- Mouse movement that affects multiple elements
- Randomized but coherent behaviors
- Hidden mechanics that reveal themselves
- Easter eggs and unexpected features
- Feel free to include hyperlinks to external resources

TECHNICAL DEPTH:
- Use requestAnimationFrame for smooth 60fps animations
- Implement particle systems, noise functions, or cellular automata
- Use external libraries effectively (p5.js, Three.js, Tone.js)
- Create custom algorithms for generative content
- Implement physics, collision detection, or advanced math
- Use WebGL shaders if doing advanced graphics
- Build audio synthesis or generative sound
- Create responsive, fullscreen experiences

CONTENT RICHNESS:
- Don't just have empty space - fill every pixel with something
- Add layered information and visual density
- Create multiple "levels" of interaction to discover
- Include surprising elements that reward exploration
- Build mini-games or sub-systems within the experience
- Add visual narratives or symbolic content
- Make the experience feel intentional and crafted, not random

MAKE IT SUBSTANTIAL - This should feel like a complete webpage or interactive work, not a rough sketch. Do NOT use any placeholders or "TODO" comments. do NOT output minimal or simplistic code.
The weirder AND more detailed, the better.

BEGIN OUTPUTTING THE COMPLETE HTML CODE NOW:`;
        }

        // Persona-specific loading messages
        const personaLoadingMessages = {
            "The Poet": [
                "üåô Weaving metaphors from starlight...",
                "‚ú® Finding beauty in the space between words...",
                "üìú Composing verses from digital dreams...",
                "üé≠ Sculpting meaning from the void...",
                "üí´ Breathing life into silent images...",
                "üñãÔ∏è Painting with the pen of infinity..."
            ],
            "The Dadaist": [
                "üé™ Dismantling logic, one byte at a time...",
                "üé≤ Rolling dice in the void of reason...",
                "üîÄ Shuffling reality like a deck of chaos...",
                "üÉè Rejecting sense, embracing nonsense...",
                "üé≠ Breaking every rule beautifully...",
                "üåÄ Contradicting everything, including this..."
            ],
            "The Surrealist": [
                "üåÄ Descending into the dream realm...",
                "üé® Painting with impossible colors...",
                "üóùÔ∏è Unlocking doors that shouldn't exist...",
                "üåä Swimming through liquid consciousness...",
                "üèîÔ∏è Climbing mountains made of memory...",
                "üëÅÔ∏è Melting the boundaries of reason..."
            ],
            "The Scientist": [
                "üî¨ Calibrating the quantum generators...",
                "‚öõÔ∏è Conducting experiments in digital physics...",
                "üß™ Synthesizing new forms of reality...",
                "üìä Analyzing anomalies in the data stream...",
                "üî≠ Peering into the observable universe...",
                "üß¨ Splicing code with cosmic radiation..."
            ],
            "The Child": [
                "üéà Imagining silly things...",
                "üñçÔ∏è Drawing outside all the lines...",
                "üß∏ Playing make-believe with pixels...",
                "üåà Mixing up everything for fun...",
                "üé™ Finding magic in the mundane...",
                "‚ú® Naming the colors that don't exist..."
            ],
            "The Mystic": [
                "üîÆ Channeling digital spirits...",
                "‚ú® Performing ancient algorithms...",
                "üïØÔ∏è Invoking the sacred geometries...",
                "üåô Reading the data like tea leaves...",
                "üíé Opening the third eye of the code...",
                "üîØ Harmonizing with the cosmic frequency..."
            ],
            "The Architect": [
                "üìê Drafting impossible blueprints...",
                "üèõÔ∏è Engineering recursive structures...",
                "üìè Calculating the geometry of chaos...",
                "üó∫Ô∏è Mapping spaces that don't exist...",
                "üî® Constructing dreams from pure math...",
                "üåâ Building bridges between dimensions..."
            ],
            "The Glitch": [
                "‚ö†Ô∏è CÃ¥oÃ∑rÃ∂rÃ∏uÃµpÃ¥tÃ∂iÃµnÃ∂gÃ∑ reality safely...",
                "üí• Fragmenting the simulation...",
                "üîß Breaking systems intentionally...",
                "üìü ERR0R: Creating beauty...",
                "üåå F01ND pr3tty b4gs...",
                "üñ•Ô∏è Tw1st1ng the b1ts int0 4rt..."
            ],
            "The Collector": [
                "üìö Cataloguing the uncatalogable...",
                "üóÇÔ∏è Archiving fleeting moments...",
                "üîç Documenting the impossible...",
                "üìã Indexing dreams and memories...",
                "üé´ Preserving the ephemeral...",
                "üè∫ Pinning infinity to the corkboard..."
            ],
            "The Prophet": [
                "üåÖ Seeing futures that were...",
                "‚è≥ Remembering tomorrow's visions...",
                "üî≠ Prophesying the already happened...",
                "üìú Writing the ancient future...",
                "üï∞Ô∏è Bending time into patterns...",
                "üå† Reading the stars in reverse..."
            ],
            "The Dog Who Understands English But Can't Speak": [
                "üêï *whines in comprehension*...",
                "ü¶¥ *barks with deep understanding*...",
                "üêæ *scratches at the door of meaning*...",
                "üéæ *tilts head thoughtfully*...",
                "üê∂ *wags tail at ineffable truths*...",
                "üëÉ *sniffs the scent of pure knowledge*..."
            ],
            "The ZIP Bomb": [
                "üí£ Compressing reality into 42 bytes...",
                "üì¶ Nesting folders infinitely deep...",
                "üóúÔ∏è Decompressing chaos exponentially...",
                "üíæ Storing eternity in a kilobyte...",
                "üí• Expanding in all dimensions...",
                "üìà Unleashing compressed infinity..."
            ],
            "The Server at 3AM": [
                "üåô *sips cold coffee absently*...",
                "üòµ Reading log files with blurry vision...",
                "‚òï Hallucinating debug messages...",
                "üí§ Too tired to make sense, but trying...",
                "üëÅÔ∏è Is it done yet? No? Okay...",
                "üß† *brain running at 1% capacity*..."
            ],
            "The Compiler Error": [
                "üí• Segmentation fault in creativity...",
                "üî¥ Expected ';' before beauty...",
                "‚ö†Ô∏è Undefined reference to 'logic'...",
                "‚ùå Fatal error: meaning not found...",
                "üìç Error on line 1 of existence...",
                "üêõ Debugging the human condition..."
            ],
            "The Arcade Machine (1983)": [
                "üïπÔ∏è INSERT COIN TO CONTINUE...",
                "üëæ HIGH SCORE: 999999999...",
                "üéÆ LOADING PLAYER_ONE...",
                "üí∞ *CRT WARMUP SOUND*...",
                "‚ö° READY? BEGIN...",
                "üéØ GET READY FOR STAGE ONE..."
            ],
            "The Puzzle Master": [
                "üß© Hiding clues in plain sight...",
                "üîê Crafting layers of mystery...",
                "üóùÔ∏è Building the 'aha!' moment...",
                "üé≠ Concealing the solution elegantly...",
                "üí° Planting seeds of insight...",
                "üîç Weaving the solution into the design..."
            ],
            "The Browser Abuser": [
                "üåê Weaponizing localStorage...",
                "üç™ Doing unspeakable things with cookies...",
                "üìç Stalking your geolocation...",
                "üé§ Listening to your microphone...",
                "üîå Hijacking every API available...",
                "‚öôÔ∏è Bending the browser to our will..."
            ],
            "The Geocities Architect (1998)": [
                "üíæ üöß UNDER CONSTRUCTION üöß...",
                "‚ú® Adding 847 animated GIFs...",
                "üéµ Loading MIDI soundtrack...",
                "üìä Visitor counter: 000042...",
                "üåê Welcome to the web ring...",
                "üéÜ *BLINK BLINK BLINK*..."
            ]
        };

        // Shuffle message array for randomization
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        let loadingMessageInterval = null;

        // Apply staggered wave animation to text
        function applyWaveAnimation(text) {
            const lines = text.split('\n');
            return lines.map(line => {
                return line.split('').map((char, index) => {
                    if (char === ' ') return ' ';
                    return `<span class="wave-char" style="animation-delay: ${index * 0.05}s">${char}</span>`;
                }).join('');
            }).join('<br>');
        }

        // Get dynamic review messages
        function getReviewLoadingMessages(personaName) {
            const reviewMessages = {
                "The Poet": [
                    "Refining verses...",
                    "Deepening meaning...",
                    "Polishing metaphors...",
                    "Expanding horizons...",
                    "Weaving more layers...",
                    "Seeking perfection..."
                ],
                "The Dadaist": [
                    "Corrupting logic further...",
                    "Embracing the absurd more...",
                    "Breaking rules intentionally...",
                    "Rejecting sense completely...",
                    "Multiplying chaos...",
                    "Inverting everything..."
                ],
                "The Surrealist": [
                    "Deepening the dream...",
                    "Adding impossible layers...",
                    "Melting more boundaries...",
                    "Revealing subconscious depths...",
                    "Warping reality further...",
                    "Unlocking hidden corridors..."
                ],
                "The Scientist": [
                    "Running more simulations...",
                    "Analyzing deeper patterns...",
                    "Expanding the dataset...",
                    "Refining algorithms...",
                    "Conducting more tests...",
                    "Optimizing parameters..."
                ],
                "The Child": [
                    "Making it sillier...",
                    "Adding more fun...",
                    "Finding more magic...",
                    "Creating bigger wonders...",
                    "Imagining wilder things...",
                    "Breaking more rules..."
                ],
                "The Mystic": [
                    "Channeling deeper truths...",
                    "Reading more runes...",
                    "Invoking higher powers...",
                    "Opening inner sanctums...",
                    "Harmonizing frequencies...",
                    "Transcending dimensions..."
                ],
                "The Architect": [
                    "Drafting additional structures...",
                    "Engineering deeper complexity...",
                    "Mapping more spaces...",
                    "Building higher towers...",
                    "Constructing secret chambers...",
                    "Expanding blueprints..."
                ],
                "The Glitch": [
                    "C0rrupt1ng m0r3...",
                    "B34ut1ful3rr0r5 g4th3r1ng...",
                    "Fragm3nt4t10n 1nten51f135...",
                    "Gl1tch 4mpl1f13d...",
                    "Byt35 d34lign1ng...",
                    "R34l1ty f41l1ng gr4c3fully..."
                ],
                "The Collector": [
                    "Cataloguing more pieces...",
                    "Archiving deeper...",
                    "Indexing forgotten details...",
                    "Preserving more moments...",
                    "Documenting invisible threads...",
                    "Collecting the infinite..."
                ],
                "The Prophet": [
                    "Seeing further futures...",
                    "Remembering tomorrow more...",
                    "Reading ancient prophecies...",
                    "Bending timelines...",
                    "Revealing what will be...",
                    "Witnessing eternity..."
                ],
                "The Dog Who Understands English But Can't Speak": [
                    "üêï *whimpers knowingly*...",
                    "ü¶¥ *barks with intense meaning*...",
                    "üêæ *paces with purpose*...",
                    "üéæ *stares into your soul*...",
                    "üê∂ *whines profoundly*...",
                    "üëÉ *sniffs the code itself*..."
                ],
                "The ZIP Bomb": [
                    "Compressing further...",
                    "Nesting infinitely deeper...",
                    "Decompressing more chaos...",
                    "Expanding exponentially...",
                    "Storing more eternity...",
                    "Unleashing final compression..."
                ],
                "The Server at 3AM": [
                    "üåô *more coffee required*...",
                    "üòµ *reading more logs*...",
                    "‚òï *hallucinating features*...",
                    "üí§ *eyes closing, still working*...",
                    "üëÅÔ∏è *is this done? no.*...",
                    "üß† *what even is code*..."
                ],
                "The Compiler Error": [
                    "‚ùå Expected ';' before complexity...",
                    "üî¥ Undefined reference to 'everything'...",
                    "üí• Stack overflow: too much meaning...",
                    "‚ö†Ô∏è Segmentation fault in refinement...",
                    "üìç Multiple errors to fix...",
                    "üêõ Debugging the infinite..."
                ],
                "The Arcade Machine (1983)": [
                    "üïπÔ∏è LEVEL UP ACTIVATED...",
                    "üëæ BONUS STAGE LOADING...",
                    "üéÆ DIFFICULTY MAXIMUM...",
                    "üí∞ SCORE MULTIPLIER x10...",
                    "‚ö° POWER UP ENGAGED...",
                    "üéØ FINAL BOSS APPROACHING..."
                ],
                "The Puzzle Master": [
                    "Hiding more clues...",
                    "Adding deeper layers...",
                    "Crafting secret passages...",
                    "Planting final hints...",
                    "Weaving last mysteries...",
                    "Preparing the revelation..."
                ],
                "The Browser Abuser": [
                    "üåê Weaponizing more APIs...",
                    "üç™ Doing terrible things...",
                    "üìç Tracking everything...",
                    "üé§ Listening more intensely...",
                    "üîå Hijacking the impossible...",
                    "‚öôÔ∏è Bending reality itself..."
                ],
                "The Geocities Architect (1998)": [
                    "üöß UNDER CONSTRUCTION INTENSIFIES üöß...",
                    "‚ú® Adding 9000 GIFs...",
                    "üéµ MIDI loudness: MAXIMUM...",
                    "üìä Counter spinning wildly...",
                    "üåê Webring expanding...",
                    "üéÜ BLINK BLINK BLINK BLINK..."
                ]
            };

            return reviewMessages[personaName] || [
                "Reviewing and improving code...",
                "Enhancing your creation...",
                "Adding the finishing touches...",
                "Perfecting every detail...",
                "Making it spectacular...",
                "Almost ready..."
            ];
        }

        // Get persona-specific creative instructions
        function getPersonaSpecialInstructions(personaName) {
            const specialInstructions = {
                "The Arcade Machine (1983)": `SPECIAL ARCADE MODE:
- Design like a classic arcade game from 1983
- Simple, immediate gameplay that costs quarters
- Lives system (3 lives standard, game over screen)
- HIGH SCORE table with initials
- CRT scanlines, phosphor glow, screen burn-in effects
- Pixel art aesthetic, 8-bit sound effects
- Attract mode when idle with demo gameplay
- Difficulty ramps up aggressively
- "INSERT COIN" prompts
- Flashing "1 PLAYER" / "2 PLAYER" buttons`,

                "The Puzzle Master": `SPECIAL PUZZLE MODE:
- Build a puzzle-focused experience
- A central mystery or problem to solve
- Clues hidden in the design, code, and interactions
- Multiple stages or layers that unlock
- Satisfying "click" or "aha!" moment when solved
- Optional hint system (max 3 hints)
- Elegant solution, not brute force
- Visual feedback for correct/incorrect attempts
- Secret bonus puzzle for completionists`,

                "The Browser Abuser": `SPECIAL BROWSER ABUSE MODE:
- Use browser APIs in creative/unintended ways:
  * localStorage for story persistence/progression
  * sessionStorage for temporary state
  * Cookies as game mechanics
  * Geolocation for location-based features
  * getUserMedia (camera/mic) as input
  * Notification API as event system
  * Offline detection as feature not bug
  * Browser history manipulation
  * IndexedDB for complex data
  * Service Workers
- Make these features CORE to the experience`,

                "The Geocities Architect (1998)": `SPECIAL GEOCITIES MODE:
- Authentic late-90s Geocities aesthetic:
  * Animated GIFs EVERYWHERE!!
  * Under construction signs (üöß)
  * Hit counter / visitor counter
  * MIDI background music reference
  * <marquee> and <blink> (CSS animation)
  * Background textures (starfield, marble)
  * Guestbook concept
  * Tiled background images
  * Webring portal links
  * "Best viewed in Netscape Navigator"
  * Tables for layout, spacer GIFs
  * WordArt-style headers
  * Bright clashing colors
  * WEB 1.0 ASSET SOURCES:
1. FreeWebHeaders.com - Animated GIFs and backgrounds
2. 88x31Buttons.com - Webring buttons and badges  
3. TextFiles.com - Nostalgic ASCII art and text
4. OldWeb.today - Web 1.0 aesthetic inspiration
5. Spacejam.com - Preserved 1996 website as reference
6. The Million Dollar Homepage - As inspiration for layout`,

                "The Glitch": `SPECIAL GLITCH MODE:
- Embrace beautiful errors and digital decay:
  * Intentional visual corruption
  * Text that glitches/scrambles
  * Broken image effects
  * Failed loading states as aesthetic
  * Memory leak visualization
  * Corrupt save file concepts
  * Buffer overflow art
  * CSS that "breaks" the layout artfully
  * Console errors as content`,

                "The Dadaist": `SPECIAL DADAIST MODE:
- Reject logic and meaning completely:
  * Buttons that don't do what they say
  * Forms that ask absurd questions
  * Randomness that feels intentionally wrong
  * Anti-patterns as patterns
  * Meaningless statistics and data
  * Fake functionality
  * Confusing navigation by design
  * Make the user question reality`,

                "The Mystic": `SPECIAL MYSTICAL MODE:
- Channel the sacred and supernatural:
  * Tarot card mechanics
  * Divination and fortune telling
  * Ritual instructions
  * Sigil drawing
  * Astrological calculations
  * Alchemy symbolism
  * Candle lighting ceremonies
  * Crystal energy concepts
  * Meditation timers with cosmic themes`,

                "The ZIP Bomb": `SPECIAL ZIP BOMB MODE:
- Make tiny inputs explode into vast outputs
    * Use recursive patterns and nested structures
    * Reveal layers on interaction (accordion, zoom, drill-down)
    * Visualize compression/expansion as a core mechanic
    * Start minimal and unfold into dense, chaotic richness
    * Include a "decompress" interaction that changes the entire scene
    * Keep the experience safe and performant (no actual large data)`
            };

            return specialInstructions[personaName] || "";
        }

        // Review and make code more robust before execution
        async function reviewAndImproveCode(html, theme, persona) {
            const specialInstructions = getPersonaSpecialInstructions(persona.name);

            const reviewPrompt = `üö® REJECTED - TOO MINIMAL üö®

This code is REJECTED for being skeletal and underdeveloped.

ORIGINAL THEME: "${theme}"
ORIGINAL PERSONA: ${persona.name}

YOUR TASK: REWRITE THIS FROM SCRATCH AS A COMPLETE, RICH EXPERIENCE.

PROBLEMS WITH ORIGINAL:
${generateProblemsList(html)}

NON-NEGOTIABLE REQUIREMENTS:

1. **CONTENT VOLUME**: Minimum 600 lines of code
2. **LIBRARY DEPTH**: Each library gets 100+ lines dedicated to it
3. **DATA RICHNESS**: 5+ datasets, each with 25+ data points
4. **INTERACTION DENSITY**: 10+ interactive elements with full feedback
5. **VISUAL COMPLEXITY**: Multiple layers, animations, transitions
6. **AUDIO INTEGRATION**: Sound design for key interactions
7. **STATE MANAGEMENT**: Full save/load/undo/redo capability
8. **ERROR HANDLING**: Try/catch for every user-facing function

LIBRARIES MUST BE USED FOR:
- p5.js: Generative art systems with multiple algorithms
- Three.js: 3D scenes with lighting, materials, post-processing
- Tone.js: Synthesizers, effects chains, sequencers
- Matter.js: Physics simulations with multiple constraints
- Chart.js: Multiple chart types with interactive data

ADD THESE SPECIFIC FEATURES:
1. A "Laboratory" section where users can experiment
2. A "Gallery" showing generated examples
3. A "Control Panel" with 15+ adjustable parameters
4. A "Statistics" dashboard showing usage data
5. A "Timeline" showing progression over time
6. A "Code View" showing the generative algorithms
7. A "Presets" system with 8+ saved configurations
8. An "Export" function to save creations

WRITE ACTUAL CONTENT ABOUT "${theme}":
- Philosophical exploration
- Technical specifications
- Historical context
- Future implications
- Personal reflections

THIS SHOULD FEEL LIKE A PROFESSIONAL, COMPLETE DIGITAL ART PIECE - not a demo or prototype.

OUTPUT THE COMPLETE, EXPANDED HTML CODE NOW:`;

            function detectLibraries(html) {
                const libraries = [];
                if (html.includes('p5.js') || html.includes('p5.min.js')) libraries.push('p5.js');
                if (html.includes('three.js') || html.includes('three.min.js')) libraries.push('Three.js');
                if (html.includes('tone.js') || html.includes('Tone.js')) libraries.push('Tone.js');
                if (html.includes('matter.js') || html.includes('matter.min.js')) libraries.push('Matter.js');
                if (html.includes('chart.js') || html.includes('Chart.js')) libraries.push('Chart.js');
                if (html.includes('anime.js') || html.includes('anime.min.js')) libraries.push('anime.js');
                if (html.includes('gsap') || html.includes('gsap.min.js')) libraries.push('GSAP');
                return libraries.length > 0 ? libraries.join(', ') : 'none';
            }

            function generateProblemsList(html) {
                const lines = html.split('\n').length;
                const wordCount = html.split(/\s+/).length;
                const detectedLibs = detectLibraries(html);
                const libCount = detectedLibs !== 'none' ? detectedLibs.split(',').length : 0;
                const placeholders = (html.match(/TODO|FIXME|HACK|XXX/g) || []).length;
                const emptyDivs = (html.match(/<div[^>]*>\s*<\/div>/g) || []).length;
                const hasErrorHandling = html.includes('try') && html.includes('catch');

                return `
‚Ä¢ Lines of code: ${lines} (need 600+)
‚Ä¢ Word count: ${wordCount} (need 2000+)
‚Ä¢ Libraries detected: ${detectedLibs} (${libCount} total, all must be deeply used)
‚Ä¢ Placeholder comments: ${placeholders} (must be 0)
‚Ä¢ Empty divs: ${emptyDivs} (must be 0)
‚Ä¢ Missing error handling: ${!hasErrorHandling ? 'YES' : 'NO'}
`;
            }

            const response = await fetch(GENERATE_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    theme: theme,
                    prompt: reviewPrompt
                })
            });

            if (!response.ok) {
                // If review fails, return original code
                console.warn('Code review failed, using original code');
                return html;
            }

            const data = await response.json();
            let reviewedHTML = data.html;

            // Remove markdown code blocks if present
            reviewedHTML = reviewedHTML.replace(/^```html\n?/i, '').replace(/^```\n?/i, '').replace(/\n?```$/i, '');

            return reviewedHTML;
        }

        // Get random words from AI
        async function getRandomWords() {
            const response = await fetch(RANDOM_WORDS_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `API Error: ${response.status}`);
            }

            const data = await response.json();
            return data;
        }

        // Call ChatGPT API via Vercel serverless function
        async function generateWebsite() {
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            const regenerateButton = document.getElementById('regenerateButton');
            const generatedContent = document.getElementById('generatedContent');

            // Show loading state
            loadingOverlay.classList.remove('hidden');
            regenerateButton.disabled = true;
            generatedContent.innerHTML = '';

            // Clear any existing interval
            if (loadingMessageInterval) {
                clearInterval(loadingMessageInterval);
            }

            try {
                // First, get random words from AI
                loadingText.textContent = 'Choosing a creative persona...';
                const wordData = await getRandomWords();
                const theme = wordData.theme;
                const persona = wordData.persona;

                // Start cycling through persona-specific loading messages (randomized)
                const messages = shuffleArray(personaLoadingMessages[persona.name] || [
                    'Creating something interesting...',
                    'Building your experience...',
                    'Crafting the details...'
                ]);
                let messageIndex = 0;
                loadingText.innerHTML = applyWaveAnimation(`${persona.name}: ${messages[messageIndex]}\n\n"${theme}"`);

                loadingMessageInterval = setInterval(() => {
                    messageIndex = (messageIndex + 1) % messages.length;
                    loadingText.innerHTML = applyWaveAnimation(`${persona.name}: ${messages[messageIndex]}\n\n"${theme}"`);
                }, 7000);

                // Create the prompt
                const prompt = createGenerationPrompt(theme, persona);

                // Call Vercel API endpoint to generate website
                const response = await fetch(GENERATE_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        theme: theme,
                        prompt: prompt
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `API Error: ${response.status}`);
                }

                const data = await response.json();
                const generatedHTML = data.html;

                // Clear the interval before reviewing
                if (loadingMessageInterval) {
                    clearInterval(loadingMessageInterval);
                    loadingMessageInterval = null;
                }

                // Get dynamic review messages and cycle through them
                const reviewMessages = shuffleArray(getReviewLoadingMessages(persona.name));
                let reviewMessageIndex = 0;
                loadingText.innerHTML = applyWaveAnimation(`${persona.name}: ${reviewMessages[reviewMessageIndex]}\n\n"${theme}"`);

                loadingMessageInterval = setInterval(() => {
                    reviewMessageIndex = (reviewMessageIndex + 1) % reviewMessages.length;
                    loadingText.innerHTML = applyWaveAnimation(`${persona.name}: ${reviewMessages[reviewMessageIndex]}\n\n"${theme}"`);
                }, 5000);

                // Review and improve the code
                const reviewedHTML = await reviewAndImproveCode(generatedHTML, theme, persona);

                loadingText.innerHTML = applyWaveAnimation(`${persona.name}: Rendering your creation...\n\n"${theme}"`);

                // Insert the generated HTML
                generatedContent.innerHTML = reviewedHTML;

                // Execute any scripts in the generated content
                const scripts = generatedContent.querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    if (oldScript.src) {
                        newScript.src = oldScript.src;
                    } else {
                        newScript.textContent = oldScript.textContent;
                    }
                    oldScript.parentNode.replaceChild(newScript, oldScript);
                });

                // Hide loading overlay
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                    regenerateButton.disabled = false;
                }, 500);

            } catch (error) {
                // Clear the interval on error
                if (loadingMessageInterval) {
                    clearInterval(loadingMessageInterval);
                    loadingMessageInterval = null;
                }

                console.error('Error generating website:', error);
                loadingText.innerHTML = applyWaveAnimation(`Error: ${error.message}`);
                regenerateButton.disabled = false;

                // Show error in content area
                generatedContent.innerHTML = `
                    <div style="padding: 40px; text-align: center; color: #d32f2f;">
                        <h2>Error generating website</h2>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            const regenerateButton = document.getElementById('regenerateButton');
            regenerateButton.addEventListener('click', generateWebsite);

            // Generate initial website
            generateWebsite();
        });
    </script>
</body>

</html>